{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e9f91cb7_27d59a97",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 908
      },
      "writtenOn": "2022-05-27T14:11:15Z",
      "side": 1,
      "message": "Nacho, interesting findings, please see minor comment below",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "efee3fcf_73e1bb8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-05-30T10:19:17Z",
      "side": 1,
      "message": "recheck",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5c1e1ed9_9c9f2f61",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-05-27T13:49:38Z",
      "side": 1,
      "message": "As we observe in the daily jobs, versions prior to 4.9 give default names to new ImageContentSourcePolicy objects using the format:\n\nimage-policy-%02d\n\nSo the first object would be named image-policy-00 and the looked for object image-policy-0 would not exist.\n\nBy removing the object name from oc-get we list all the objects but grep would take the first element of the list all the same.\n\nThe only scenario that worries me is if we had several alternate registries defined, but this does not seem to have been considered for the original solution either.",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31069148_df3d678c",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 724
      },
      "writtenOn": "2022-05-27T18:08:54Z",
      "side": 1,
      "message": "Instead of relying on the ICSP to know if the image may be available in the local registry, what about using the variables used during the mirroring to know that images were actually mirrored?\nhttps://github.com/redhat-cip/dci-openshift-agent/blob/46284dcf30d777d4946ba0fa66a2b2a993b4d97d/plays/pre-run.yml#L174",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef669bdf_c7634532",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-05-30T08:19:44Z",
      "side": 1,
      "message": "I\u0027ll give it a thought.\n\nIf I understand it right, it would entail passing the variables into the get-logs script as env vars.",
      "parentUuid": "31069148_df3d678c",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a14665c1_67c2952a",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-05-31T10:18:08Z",
      "side": 1,
      "message": "Beto, please check the current version. I\u0027m using the disconnected variables to infer the local registry URL.\n\nJust in my current version, I still rely on the ICSP in case we can\u0027t resolve the URL through the disconnected mode variables.\n\nDo you think this makes sense, or can we just remove the use of ICSP?",
      "parentUuid": "ef669bdf_c7634532",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c98f9c8c_b5db20b0",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 724
      },
      "writtenOn": "2022-05-31T19:36:11Z",
      "side": 1,
      "message": "Hello Nacho , thank for this.\n\nI think that having ICSP do not guarantee that we mirrored the image, we may have changes there that we will need to change the parsing method later again. Should be ok to get rid of it.\n\nI see that the tests are failing. What about defining a new fact/var with the evaluation of images_mirrored \u003d  (dci_disconnected or dci_local_mirror) if true, then use the local_registry port/host in the script.",
      "parentUuid": "a14665c1_67c2952a",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "24eead17_790108e2",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 126,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-07-14T09:06:06Z",
      "side": 1,
      "message": "OK, Beto,\n\nSo I removed the part where we try to resolve the image url out of the ICSP so now we only rely on the local_registry if it\u0027s defined.\n\nI\u0027m checking the output of the latest jobs and they seem to work as expected.\n\nI hope this sets the CR ready for merging.",
      "parentUuid": "c98f9c8c_b5db20b0",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2f2a82ca_0d744ec2",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 127,
      "author": {
        "id": 908
      },
      "writtenOn": "2022-05-27T14:11:15Z",
      "side": 1,
      "message": "Because now we are listing all ICSPs, I think we need to consider the updating this line to something like:\njq -r \u0027.items[].spec.repositoryDigestMirrors[].mirrors[]\u0027",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e0e23bbe_20d1ddb0",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 127,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-05-31T10:18:08Z",
      "side": 1,
      "message": "I believe you\u0027re right, Manny. Thanks.",
      "parentUuid": "2f2a82ca_0d744ec2",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "afcd5c0c_0566b530",
        "filename": "plays/scripts/get-logs",
        "patchSetId": 1
      },
      "lineNbr": 127,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-05-31T10:21:21Z",
      "side": 1,
      "message": "My bad, Manny. I rolled back to getting only the first ICSP following Beto\u0027s suggestion of using the disconnected mode variables.\nPlease, check my last answer to Beto. I\u0027d like to know your opinion as well.",
      "parentUuid": "e0e23bbe_20d1ddb0",
      "revId": "d6182dee444da61e1f86614fef4ccf69444bd53e",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}