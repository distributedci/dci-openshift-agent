{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "33ef2a99_2dc609e7",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-16T10:51:23Z",
      "side": 1,
      "message": "Hi Beto, can you help me decide on the code structure? \n\nI want to use the restart-OLM workaround in both agent and app-agent. I\u0027m not sure whether I should:\n1/ make a separate task and call it using \u0027tasks_from\u0027, or \n2/ just put it in the main task protected by a condition like \u0027OCPBUGS-13286 in dci_workarounds\u0027. \n\nWhat do you think is best?\n\nThanks.",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f52be6dc_ddbff0d2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-16T12:47:18Z",
      "side": 1,
      "message": "recheck",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1bf61b3e_53d5c124",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-08-16T13:57:17Z",
      "side": 1,
      "message": "LGTM, Thanks!",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d8d73eeb_dde885be",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 724
      },
      "writtenOn": "2023-08-16T14:33:41Z",
      "side": 1,
      "message": "Hello Tatiana, thanks for the change.\n\nIMHO, we should restart the pod just after disabling the default catalog sources just as a sanity action to clean up the cache. In that case, that won\u0027t need to be managed as a workaround, just as part of the regular workflow. At some time a remember reading that it was recommended to restart some stuff after removing the default catalogs.\n\nWhat about that, can we give it a try to that instead of dealing with it using a WA for a bug already reported for other teams that will be scheduled for fix soon? \n\nRegards",
      "parentUuid": "33ef2a99_2dc609e7",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "847072bc_33ba601f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 724
      },
      "writtenOn": "2023-08-16T14:35:08Z",
      "side": 1,
      "message": "Just after:\n\nhttps://github.com/redhat-cip/dci-openshift-agent/blob/44b083de5b90a418113ebe6a00a1a9c241d91148/plays/prepare-operators.yml#L34",
      "parentUuid": "d8d73eeb_dde885be",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c58f8bb9_59bafba9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-16T19:09:52Z",
      "side": 1,
      "message": "Hi Beto, thanks for the idea, I\u0027ll use it in a bit modified way. \n\nThe issue is that OLM still depends on the old CatalogSource that has been removed. So, we could consider restarting the OLM pod each time the new CatalogSource is prepared, within the catalog-source role: https://github.com/redhat-cip/dci-openshift-agent/blob/44b083de5b90a418113ebe6a00a1a9c241d91148/common-roles/catalog-source/tasks/main.yml#L35 \n\nThen, concerning a fix for preflight, which is running a part of the OLM installation under the hood, we could make a similar change in the mirror-catalog role. Tony will soon use it in doaa: https://softwarefactory-project.io/r/c/dci-openshift-app-agent/+/29152\n\nWdyt? Let me push the change because I probably explain not super clear.",
      "parentUuid": "847072bc_33ba601f",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f65063ae_30f30f57",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 724
      },
      "writtenOn": "2023-08-16T19:29:47Z",
      "side": 1,
      "message": "The issue is that \"after removing catalog\" sources, the OLM pod still has in its cache information that will be used when it tries to resolve dependencies for new subscriptions. \n\n$ oc get operator hub cluster -o yaml\napiVersion: config.openshift.io/v1\nkind: OperatorHub\n\u003c\u003csnip\u003e\u003e\n  disableAllDefaultSources: true\nstatus:\n  sources:\n  - disabled: true\n    name: certified-operators\n    status: Success\n  - disabled: true\n    name: community-operators\n    status: Success\n  - disabled: true\n    name: Redhat-marketplace\n    status: Success\n  - disabled: true\n    name: Redhat-operators\n    status: Success\n\nredhat-marketplace is one that we have seen most of the times\n\nIf we restart the pod after disabling the catalogs will benefit the operator\u0027s subscriptions that we create in DOA and also the workloads running via DOAA.\n\nIt should work also only doing that on the catalog-source role just before or after creating a catalog, but we may be running it more times than needed.",
      "parentUuid": "c58f8bb9_59bafba9",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11b51777_933f1ec7",
        "filename": "common-roles/olm-operator/tasks/main.yml",
        "patchSetId": 1
      },
      "lineNbr": 130,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-08-16T12:08:30Z",
      "side": 1,
      "message": "Let\u0027s add the dci_workaround and its bug ID otherwise we will forget about this when fixed",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6cc21ce_c048bb31",
        "filename": "common-roles/olm-operator/tasks/main.yml",
        "patchSetId": 1
      },
      "lineNbr": 130,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-16T12:44:38Z",
      "side": 1,
      "message": "Hi Tony, thanks for checking, it\u0027s added right above ^^",
      "parentUuid": "11b51777_933f1ec7",
      "revId": "8e0a18125cb595c908cd910d4056bad956bec5f0",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}