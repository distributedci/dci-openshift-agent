---
- name: Create hosted cluster namespace
  community.kubernetes.k8s:
    definition:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: "{{ ah_clusters_ns }}-{{ ah_cluster_name }}"
        labels:
          security.openshift.io/scc.podSecurityLabelSync: "false"
          pod-security.kubernetes.io/enforce: "baseline"
          pod-security.kubernetes.io/enforce-version: "latest"

- name: Deploy a "none" hypershift cluster
  shell:
    cmd: >
      {{ ah_cli_path }} create cluster {{ ah_cluster_type }}
      --name={{ ah_cluster_name }}
      {% if ah_pullsecret_file | length %}
      --pull-secret={{ ah_pullsecret_file }}
      {% endif %}
      --namespace={{ ah_clusters_ns }}-{{ ah_cluster_name }}
      --base-domain={{ ah_base_domain }}
      --cluster-cidr={{ ah_cluster_network_cidr }}
      --release-image={{ ah_release_image }}
  register: ah_create_cluster
  when: ah_cluster_type == "none"

- name:
- name: Generate hypershift kubeconfig
  shell:
    cmd: >
      {{ ah_cli_path }} create kubeconfig
      --namespace={{ ah_cluster_name }}-{{ ah_cluster_name }}
      --name {{ ah_cluster_name }}
  register: ah_kubeconf
#
# TODOs:
# For Baremetal:
# - Create InfraEnv
# - Create Agents
# - Add NodePools
# - Add nodes to the cluster
# Add disconnected support
# - "Get the user_ca_bundle content"
# - Pullsecrets from within? or from the agent?
