---
- name: Add Storage node labels
  community.kubernetes.k8s:
    validate_certs: false
    state: present
    definition:
      apiVersion: v1
      kind: Node
      metadata:
        name: "{{ hostvars[node].name }}"
        labels:
          "{{ hostvars[node].lso_label }}"
  loop: "{{ groups['ocs_nodes'] }}"
  loop_control:
    loop_var: node
    label: "{{ hostvars[node].name }}"
  when:
    - groups['ocs_nodes'] is defined
    - hostvars[node].lso_label is defined

- name: Configure Local Storage Volumes
  community.kubernetes.k8s:
    definition: "{{ lookup('template', 'local-storage-block.yml.j2') }}"
  register: local_storage_volcrd

- name: Delay for Storage Class to be ready before setting as default
  pause:
    minutes: 1
  when: local_storage_volcrd.changed | bool

- name: Set Local Storage Class as default
  community.kubernetes.k8s:
    validate_certs: false
    state: present
    definition:
      apiVersion: storage.k8s.io/v1
      kind: StorageClass
      metadata:
        name: "{{ local_storage_class }}"
        namespace: "{{ local_storage_namespace }}"
        annotations:
          "{{ default_storageclass_annotation }}"
  when:
    - not enable_ocs | default(false) | bool
...
