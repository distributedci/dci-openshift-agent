---
- name: "Get current worker's MCP"
  community.kubernetes.k8s_info:
    api_version: machineconfiguration.openshift.io/v1
    kind: MachineConfigPool
    name: worker
  register: worker_mcp

- name: "Get current worker's Machine config Pools"
  set_fact:
    acm_mc: "{{ worker_mcp.resources[0].spec.configuration.name }}"

- name: "Get current worker's Machine configs"
  community.kubernetes.k8s_info:
    api_version: machineconfiguration.openshift.io/v1
    kind: MachineConfig
    name: "{{ acm_mc }}"
  register: worker_mc

- name: "Get hub cluster pull_secret details"
  community.kubernetes.k8s_info:
    api: v1
    kind: Secret
    name: "pull-secret"
    namespace: openshift-config
  register: acm_pull_secret

- name: "Setting config facts based on Hub Cluster configs"
  set_fact:
    acm_ssh_key: "{{ worker_mc.resources[0].spec.config.passwd.users[0].sshAuthorizedKeys[0] }}"
    acm_pull_secret: '{{ acm_pull_secret.resources[0].data[".dockerconfigjson"] }}'
...
