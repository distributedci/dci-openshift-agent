---

  - name: "Get major and minor versions"
    set_fact:
      ocp_major: "{{ base_version.split('.')[0] }}"
      ocp_minor: "{{ base_version.split('.')[1] }}"

  - name: "Create a tmp directory for the prune image"
    tempfile:
      state: directory
    register: tmp_prune

  - name: "Index prune - recursive"
    include_tasks: index-prune.yml

  - name: "Operator index version that will be used"
    debug:
      msg: "{{ ocp_major }}.{{ ocp_minor }}"

  - name: "Set new OPM version base on pruned index"
    set_fact:
      dci_opm_version: "v{{ ocp_major }}.{{ ocp_minor }}"

  - name: "Create DCI component for pruned Index"
    dci_component:
      name: "{{ dci_opm_version }}"
      canonical_project_name: "{{ opm_local_registry_path | basename }}:{{ dci_opm_version }}"
      team_id: "{{ job_info['job']['team_id'] }}"
      topic_id: "{{ job_info['job']['topic_id'] }}"
      type: "{{ opm_local_registry_path | basename }}"
      state: present
    register: index_component

  - name: "Attach index component to the job"
    dci_job_component:
      component_id: " {{ index_component.component.id }} "
      job_id: " {{ job_id }} "
    when:
      - "'component' in index_component"
      - "'id' in index_component.component"
...
