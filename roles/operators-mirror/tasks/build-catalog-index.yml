---

  - name: "Get major OCP version"
    set_fact:
      ocp_major: "{{ base_version.split('.')[0] }}"

  - name: "Get minor OCP minor"
    set_fact:
      ocp_minor: "{{ base_version.split('.')[1] }}"

  - name: "Create a tmp directory for the prune image"
    tempfile:
      state: directory
    register: tmp_prune

  - name: "Index prune - recursive"
    include_tasks: index-prune.yml

  - name: "Operator index version that will be used"
    debug:
      msg: "{{ ocp_major }}.{{ ocp_minor }}"

  - name: "Create component for pruned image"
    dci_component:
      name: "{{ local_registry }}{{ opm_local_registry_path }}:v{{ ocp_major }}.{{ ocp_minor }}"
      canonical_project_name: "{{ local_registry }}{{ opm_local_registry_path }}:v{{ ocp_major }}.{{ ocp_minor }}"
      team_id: "{{ job_info['job']['team_id'] }}"
      topic_id: "{{ job_info['job']['topic_id'] }}"
      type: "catalog_index"
      data: "{{ local_registry }}{{ opm_local_registry_path }}:v{{ ocp_major }}.{{ ocp_minor }}"
      state: present
    register: index_component

  - name: "Attach index component to the job"
    dci_job_component:
      component_id: " {{ index_component.component.id }} "
      job_id: " {{ job_id }} "
    when:
      - "'component' in index_component"
      - "'id' in index_component.component"
...
