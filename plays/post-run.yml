---

- name: Set outputs to be copied
  set_fact:
    outputs:
      kubeconfig: "~/clusterconfigs/auth/kubeconfig"

- name: Copy outputs if defined
  delegate_to: "{{ groups['provisioner'][0] }}"
  fetch:
    src: "{{ outputs[item.key] }}"
    dest: "{{ item.value }}"
    flat: true
  with_dict: "{{ job_info.outputs }}"
  when: job_info.outputs is defined and job_info.outputs != None

- name: Save job info in the cluster
  environment:
    - KUBECONFIG: "{{ dci_cluster_configs_dir }}/kubeconfig"
  block:
    - name: "Create DCI namespace"
      k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: openshift-dci

    - name: "Create DCI configmap"
      k8s:
        state: present
        definition:
          apiVersion: v1
          kind: ConfigMap
          metadata:
            name: doa
            namespace: openshift-dci
          data:
            job_info: "{{ job_info | to_json }}"
  when: dci_cluster_metadata | default(false) | bool

...
