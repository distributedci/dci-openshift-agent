---
- name: get .git directory's stats
  stat:
    path: "{{ item }}/.git"
  register: stat_directory

- name: get last commit id  # noqa 303 305
  shell: git log --format="%H" -n 1
  register: last_commit_id
  when: stat_directory.stat.exists

- name: Create git repo component
  dci_component:
    name: "{{ item| basename  last_commit_id[:7] }}"
    canonical_project_name: "{{ item| basename  last_commit_id[:7] }}"
    team_id: "{{ job_info['job']['team_id'] }}"
    topic_id: "{{ job_info['job']['topic_id'] }}"
    type: rpm
    url: local
    state: present
  register: git_component
  when: stat_directory.stat.exists

- name: 'Attach git component to the job'
  dci_job_component:
    component_id: " {{ git_component.component.id }} "
    job_id: " {{ job_id }} "
  when: stat_directory.stat.exists
...
