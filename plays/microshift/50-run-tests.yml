---
- name: Check the variables needed to test Microshift
  fail:
    msg: "variable {{ item }} not defined"
  when: item is not defined
  with_items:
    - _kubeconfig

- name: Test MicroShift
  block:
    - name: Testing OCP API
      community.kubernetes.k8s_info:
        kind: Node
        kubeconfig: "{{ _kubeconfig }}"
        validate_certs: false
      register: cluster_nodes
      ignore_errors: true

    - name: Nodes in cluster
      debug:
        var: cluster_nodes
      ignore_errors: true
