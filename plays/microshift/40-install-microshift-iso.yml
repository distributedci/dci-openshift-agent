---
- name: Check the variables needed to install ISO on SUTs
  assert:
    that: "{{ item }} is defined"
    quiet: true
  with_items:
    - _suts

- name: Clean any previous Microshift img files before proceeding
  file:
    path: "/var/lib/libvirt/images/microshift-{{ item.name }}.img"
    state: absent
  with_items: "{{ _suts }}"

- name: Install ISO on SUTs
  include_role:
    name: redhatci.ocp.vendors.kvm
    tasks_from: iso.yml
  vars:
    boot_iso_url: http://localhost:80/microshift.iso
    target_host: "{{ item.name }}"
  with_items: "{{ _suts }}"
