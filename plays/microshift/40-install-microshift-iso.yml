---
- name: Setup a http server
  vars:
    http_dir: "{{ http_store }}"
    http_data_dir: "{{ http_store }}/data"
    inventory_validated: true
  include_role:
    name: redhatci.ocp.setup_http_store

- name: Copy ISO image into http store
  ansible.builtin.copy:
    src: "/tmp/microshift.iso"
    dest: "{{ http_store }}/data/"
    remote_src: true

- name: Install ISO on SUTs
  include_role:
    name: redhatci.ocp.install_iso
  vars:
    boot_iso_url: http://localhost:80/microshift.iso
    target_host: "{{ item.key }}"
    bmc_address: "{{ sushy_tools_bmc_address }}"
    bmc_user: "{{ sushy_tools_bmc_user }}"
    bmc_password: "{{ sushy_tools_bmc_password }}"
  with_items: "{{ hostvars.localhost.system_inventory | dict2items }}"
