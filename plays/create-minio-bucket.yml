---    
- name: Create the bucket {{ minio_bucket_name }}
  vars:
    minio_client: |-
      {%- if dci_disconnected | default(false) %}
      {{ dci_local_registry }}/minio/mc
      {%- else %}
      quay.io/minio/mc
      {%- endif %}
    minio_image: |-
      {%- if dci_disconnected | default(false) %}
      {{ dci_local_registry }}/minio/minio
      {%- else %}
      quay.io/minio/minio
      {%- endif %}
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: batch/v1
      kind: Job
      metadata:
        name: minio-{{ minio_bucket_name }}-bucket
        namespace: "{{ minio_namespace }}"
      spec:
        template:
          metadata:
            name: minio-bucket-{{ minio_bucket_name }}
          spec:
            containers:
              - name: minio-client
                image: "{{ minio_client }}"
                command:
                  - "/bin/sh"
                  - "-c"
                  - >
                    mc --config-dir /tmp/
                    alias set
                    local {{ minio_endpoint }}
                    {{ minio_access_key_id }} {{ minio_access_key_secret }}
                    --api S3v4;
                    mc --config-dir /tmp/
                    mb --ignore-existing
                    local/{{ minio_bucket_name }}
            restartPolicy: Never
    wait: true
    wait_sleep: 10
    wait_timeout: 420
    wait_condition:
      type: Complete
      status: "True"
  no_log: true
...
