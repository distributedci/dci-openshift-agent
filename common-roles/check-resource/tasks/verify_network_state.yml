---
- name: Check ovnkube-node-XXX pods and handle the error
  block:
    - name: Check the state of ovnkube-node-XXX pods
      shell: >
        {{ oc_tool_path }} get pods -n openshift-ovn-kubernetes --no-headers=true |
        awk '! /Running/ && /ovnkube-node/'
      register: bad_ovnkube_pods
      retries: 6
      delay: 30
      until: bad_ovnkube_pods.stdout | length == 0

  rescue:
    - name: Fail when network is in a bad state
      fail:
        msg: "Failing because some of ovnkube-node-XXX pods are not in a running state"

...
