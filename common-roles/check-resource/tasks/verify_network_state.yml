---
- name: Check ovnkube-node-XXX pods and handle the error
  block:
    - name: "Wait until all pods in openshift-ovn-kubernetes namespace are running"
      community.kubernetes.k8s_info:
        kind: Pod
        namespace: "openshift-ovn-kubernetes"
      register: ovn_pods
      until: ovn_pods | json_query('resources[*].status.phase') | unique == ["Running"]
      retries: 6
      delay: 30

  rescue:
    - name: Fail when network is in a bad state
      fail:
        msg: "Failing because some of ovnkube-node-XXX pods are not in a running state"

...
